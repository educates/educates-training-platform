#@ load("@ytt:data", "data")
#@ load("@ytt:overlay", "overlay")
#@ load("@ytt:assert", "assert")

#@  (hasIrsaRoleCertManager, _) = assert.try_to(lambda: len(data.values["clusterInfrastructure"]["aws"]["irsaRoles"]["cert-manager"]) > 0)

#@  if hasIrsaRoleCertManager:
#@    certManagerIrsaRole = data.values["clusterInfrastructure"]["aws"]["irsaRoles"]["cert-manager"]
#@  else:
#@    fail("cert-manager is enabled and can not be configured. Missing irsaRole")
#@  end

#@overlay/match-child-defaults missing_ok=True
clusterPackages:
  cert-manager:
    enabled: true
    settings:
      serviceaccount:
        annotations:
          eks.amazonaws.com/role-arn: #@ certManagerIrsaRole
