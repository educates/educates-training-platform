# Training Portal Build System
#
# Usage Examples:
#   just                                    # Run default recipe (build-project)
#   just build-project                      # Build the complete project (venv + packages + static files)
#   just venv                               # Create Python virtual environment only
#   just update-packages                    # Update Python packages (creates venv if needed)
#   just static                             # Collect static files (builds everything if needed)
#   just build-migrations                   # Build Django migrations
#   just clean-project                      # Clean all build artifacts
#   just --list                             # Show all available recipes

# Default recipe
default: build-project

# Create Python virtual environment
venv:
    python3.10 -m venv venv

# Update Python packages
update-packages: venv
    venv/bin/pip install -r requirements.txt

# Collect static files
static: venv update-packages
    venv/bin/python src/manage.py collectstatic --no-input

# Build the project
build-project: venv update-packages static

# Build Django migrations
build-migrations: venv update-packages
    venv/bin/python src/manage.py makemigrations

# Clean project artifacts
clean-project:
    rm -rf src/project/__pycache__ src/project/*/__pycache__
    rm -rf src/project/*/*/__pycache__ src/project/*/*/*/__pycache__
    rm -f data/db.sqlite3 data/secret-key.txt
    rm -rf src/static
    rm -rf venv